<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>mach_star readme</title>
	<style type="text/css">
	body {
		font-family: 'Lucida Grande', sans;
		padding-left: 200px;
		font-size: 80%;
	}
	code {
		font-size: 120%;
	}
	img { /* make images centered by default */
		display: block;
		margin-left: auto;
		margin-right: auto
	}
	h1 {
		font-size: 100%;
	}
	h1:before {	
		content: "\21D2\20"
	}
	h1 {
		color: #19074e;
	}
	
	#sidebar {
		position:fixed;
		top: 8px;
		left: 8px;
		width:192px;
		text-align: center;
	}
	
	#sidebar #pic {
		height:192px;
		background:url(elsimo-192-2.jpg)
	}
	
	#sidebar #title {
		margin-top: 16px;
		font-size:14px;
	}
	
	#sidebar #link {
		margin-top: 4px;
		font-size:11px;
	}
	
	#sidebar #by {
		margin-top: 8px;
		font-size:11px;
		color:#999;
		font-weight:bold;
	}
	
	#sidebar #nav {	
		margin-top: 16px;
		text-align: left;
		padding: 8px;
		font-weight: bold;
		font-size: 12px;
		background: url(bg.png) no-repeat;
		min-height: 192px;
		line-height: 150%;
	}
	
	#sidebar #nav a {	
		text-decoration: none;
		color: #19074e;
	}
	#sidebar #nav a:before {	
		content: "\21D2\20"
	}
	#sidebar #nav a:hover {	
		text-decoration: underline;
	}
	</style>
</head>
<body>

<div id="sidebar">
	<div id="pic"></div>
	
	<div id="title">
		<span style="font-weight:bold;color:#19074e">mach_star</span>
		<span style="color:#3f79a1">1.2</span>
	</div>
	
	<div id="link"><a href="http://rentzsch.com/mach_star/">http://rentzsch.com/mach_star/</a></div>
	
	
	<div id="by">by Jonathan &lsquo;Wolf&rsquo; Rentzsch
		<br>+ friends
	</div>
	
	<div id="nav">
		<a href="#introduction">Introduction</a><br>
		<a href="#whatsnew">What's New</a><br>
		<a href="#history">History</a><br>
		<a href="#todo">Todo</a><br>
		<a href="#knownissues">Known Issues</a><br>
		<a href="#support">Support</a><br>
		<a href="#documentation">Documentation</a><br>
		<a href="#projectlayout">Project Layout</a><br>
		<a href="#license">License</a><br>
		<a href="#credits">Credits</a><br>
	</div>
</div>

<!-- -->
<h1><a name="introduction">Introduction</a></h1>

<p><code>mach_star</code> is an open-source code suite for suppressing, replacing and/or extending Mac OS X functionality at a very low level. Its principal components are <code>mach_override</code> (replace and/or extend existing functions at runtime) and <code>mach_inject</code> (dynamically load your code into a running process). If you&#8217;re new to <code>mach_star</code>, be sure to check out the <a href="#documentation">documentation</a> and <a href="#projectlayout">project layout</a> to get the lay of the land.</p>

<h1><a name="whatsnew">What&#8217;s New</a></h1>

<p><strong><code>mach_star</code> 1.2 (Sun Dec 25 2005) <a href="http://rentzsch.com/share/mach_star-1.2.zip">download</a></strong> &rArr;</p>

<ul>
<li><p>New API function: <code>mach_override_ptr()</code>. Use it to override by function address (instead of C-string function symbol name).</p></li>
<li><p><code>mach_override()</code> now uses <code>mach_override_ptr()</code> under the hood. The practical difference is that <code>mach_override()</code> will now <code>assert()</code>+die when a symbol can&#8217;t be found, instead of <code>NULL</code>-deference+die. Meh, it should actually return an error.</p></li>
<li><p>Merry Christmas!</p></li>
<li><p>Add <code>test_mach_override.[ch]</code> which exercises <code>mach_override</code> and screams if it fails. First baby step in covering this code in tests. Right now it covers overriding+reentry of local functions by pointer and overriding+reentry of system functions by pointer and name. For completeness sake, it should also test just overriding (wholesale replacement, sans reentry). The test is a little weird, I have to introduce a level of indirection (function pointers) to get past gcc&#8217;s optimizer (see <code>Design note:</code> in <code>test_mach_override.h</code> for details).</p></li>
</ul>

<h1><a name="history">History</a></h1>

<p><strong><code>mach_star</code> 1.1.1 (Sun Dec 18 2005) <a href="http://rentzsch.com/share/mach_star-1.1.1.zip">download</a></strong> &rArr;</p>

<ul>
<li><p>General Xcode 2.2 project cleanup. <code>mach_star</code> now includes <code>.xcodeproj</code> Xcode 2.2 project files for all of its projects. The old <code>.xcode</code> project files have been left in place, but they aren&#8217;t maintained and may not work. Xcode 2.2 is the recommended <code>mach_star</code> development environment &#8212; Xcode 2.1 had a bug with inter-project dependancies which would cause compilation failure. It works now again in Xcode 2.2.</p></li>
<li><p>Inter-project dependancies should working under Xcode 2.2. Any project you pick, you should just be able to hit the &#8220;Build&#8221; button and everything should Just Work&trade;.</p></li>
<li><p>There was a stray reference to my username in one of the project, which causes compilation headaches for some folks.</p></li>
<li><p>Bug fix: in <code>mach_inject_bundle.c</code>&#8217;s <code>mach_inject_bundle_pid()</code> I no longer call <code>CFRelease()</code> on the framework bundle reference. Reported by Scott Kevill.</p></li>
<li><p>Added some explicit casts now required by gcc 4.</p></li>
<li><p>Added this document.</p></li>
</ul>

<p><strong><code>mach_star</code> 1.1 (Wed Apr 06 2005) <a href="http://rentzsch.com/share/mach_star-1.1.zip">download</a></strong> &rArr;</p>

<ul>
<li><p>New package added: <code>mach_inject_bundle</code>. It has a private subproject: <code>mach_inject_bundle_stub</code>. The stub is a generic reusable implementation of the code that gets squirted across the address spaces, which was always tricky to write. <code>mach_inject_bundle</code> is an embeddable framework that wraps <code>mach_inject</code> and the stub with a simple fire-and-forget API.</p></li>
<li><p>The &#8220;DisposeWindowBeeperOverride&#8221; example is replaced by &#8220;DisposeWindow+Beep&#8221;.</p></li>
<li><p>The &#8220;FinderDisposeWindowBeeperInjector&#8221; is replaced by &#8220;DisposeWindow+Beep_Injector&#8221;.</p></li>
<li><p>All the text is now wrapped to 80 chars wide. Done to print nicely in Scott Knaster&#8217;s <a href="http://www.amazon.com/exec/obidos/ASIN/076458345X">Hacking Mac OS X Tiger</a>. Probably will undo this word-wrap in the future. We all have widescreens nowadays, right? ;-)</p></li>
<li><p>Thanks to Jon Gotow for letting me peek at <code>SCPatch</code>, which I used as a guide for <code>mach_inject_bundle</code>. It saved me a bunch of time. Also thanks to Bob Ippolito for <code>CALL_ON_LOAD</code> assistance.</p></li>
</ul>

<p><strong><code>mach_star</code> 1.0 (Wed Jun 18 2003)</strong> &rArr;</p>

<ul>
<li>Initial release at MacHack 2003.</li>
</ul>

<h1><a name="todo">Todo</a></h1>

<p>Rough timeline:</p>

<ul>
<li>mach_inject x86.</li>
<li>Command-line tool for loading bundles. Handy for debugging.</li>
<li>Correctly handle VM slide using Bob Ippolito&#8217;s design/code.</li>
<li>Add more asseertions.</li>
<li>Cover with tests.</li>
<li>More aggressive symbol lookup.</li>
<li>Overriding by function pointer (not just symbol name).</li>
<li>Unoverride.</li>
<li>Type-safety (C++ only).</li>
</ul>

<h1><a name="knownissues">Known Issues</a></h1>

<p><code>mach_inject_bundle_stub</code>&#8217;s use of <code>CALL_ON_LOAD</code> now trips a deprecation warning. I&#8217;m currently unwilling to sacrifice backwards compatibility to silence this warning.</p>

<h1><a name="support">Support</a></h1>

<p>Unless it&#8217;s sensitive, it&#8217;s your best interest to send questions, comments, suggestions and patches concerning <code>mach_star</code> to the public <a href="http://sourceforge.net/mailarchive/forum.php?forum_id=1295">extendamac-macosx mailing list</a>. The community has better latency than I do. </p>

<h1><a name="documentation">Documentation</a></h1>

<p>If you want to understand how <code>mach_star</code> works underneath the covers, my <a href="http://rentzsch.com/papers/overridingMacOSX">MacHack 2003 paper</a> is a great place to start.</p>

<p>Regarding <em>using</em> <code>mach_star</code>, <a href="http://rentzsch.com/mach_override/doxygen/"><code>mach_override</code></a> and <a href="http://rentzsch.com/mach_inject/doxygen/"><code>mach_inject</code></a> both offer doxygen API-level documentation, but you&#8217;ll probably find the sample code projects (<code>DisposeWindow+Beep</code> and <code>DisposeWindow+Beep_Injector</code>) of more value in terms of understanding the code flow and how to <em>use</em> the APIs.</p>

<p>Nowadays, if you&#8217;re intending to inject code, I recommend the higher-level <code>mach_inject_bundle</code> API to the lower-level <code>mach_inject</code> API. <code>mach_inject_bundle</code> handles a lot of pain for you.</p>

<h1><a name="projectlayout">Project Layout</a></h1>

<p>All these interrelated project files! Here, let me draw you a map:</p>

<p><img src="project.png" alt="project" title="" /></p>

<h1><a name="license">License</a></h1>

<p><code>mach_star</code> is licensed under <a href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution License 2.0</a>. Read the license for details, but the gist is you can use <code>mach_star</code> however you&#8217;d like so long as you give me credit. That mostly means putting</p>

<p><em>Portions Copyright (c) 2003-2005 Jonathan &#8216;Wolf&#8217; Rentzsch</em></p>

<p>In your About Box.</p>

<h1><a name="credits">Credits</a></h1>

<p>Thanks to Eric Gundrum for kicking off Extendamac, Eric Roccasecca for patches, Doug McLean for patches, Jon Gotow for design+code ideas and Bob Ippolito for patches. Also thanks to the numerous contributors who wish to remain anonymous.</p>

<p>Mucho gracias to <a href="http://www.howellgolson.com/">Howell Golson</a> for gifting the world with <a href="http://www.tinyshowcase.com/artwork.php?id=55">El Sismo</a> and agreeing to having him be <code>mach_star</code>&#8217;s official mascot. Aye! indeed.</p>

<!-- -->

</body>
</html>
